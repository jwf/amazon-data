    def get_digital_orders_by_category(self, category, min_price=None, max_price=None, start_date=None, end_date=None, page=1, limit=100, sort_by='order_date', sort_order='desc'):
        """Get digital orders filtered by category with price and date filters"""
        orders = []
        
        with get_db() as conn:
            cursor = conn.cursor()
            
            where_conditions = [
                "our_price IS NOT NULL",
                "our_price > 0",
                "product_name IS NOT NULL"
            ]
            
            query_params = []
            
            if category == 'Prime Membership':
                where_conditions.append("LOWER(product_name) LIKE ?")
                query_params.append('%prime%')
            elif category == 'Paramount+':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%paramount%', '%paramount+%'])
            elif category == 'STACK TV':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%stacktv%', '%stack tv%'])
            elif category == 'Video Streaming':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?) AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ?")
                query_params.extend(['%video%', '%streaming%', '%prime%', '%paramount%'])
            elif category == 'Movies':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%movie%', '%film%'])
            elif category == 'Books & eBooks':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%book%', '%kindle%'])
            elif category == 'Music':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%music%', '%song%', '%album%'])
            elif category == 'Apps & Software':
                where_conditions.append("(LOWER(product_name) LIKE ? OR LOWER(product_name) LIKE ?)")
                query_params.extend(['%app%', '%software%'])
            elif category == 'Games':
                where_conditions.append("LOWER(product_name) LIKE ?")
                query_params.append('%game%')
            elif category == 'Other Subscriptions':
                where_conditions.append("(subscription_order_info IS NOT NULL AND subscription_order_info != 'Not Applicable' AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ?)")
                query_params.extend(['%prime%', '%paramount%', '%stacktv%', '%stack tv%'])
            elif category == 'Other Digital':
                where_conditions.append("LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND LOWER(product_name) NOT LIKE ? AND (subscription_order_info IS NULL OR subscription_order_info = 'Not Applicable')")
                query_params.extend(['%movie%', '%film%', '%book%', '%kindle%', '%music%', '%song%', '%album%', '%app%', '%software%', '%game%'])
            
            if min_price is not None:
                where_conditions.append("our_price >= ?")
                query_params.append(float(min_price))
            if max_price is not None:
                where_conditions.append("our_price <= ?")
                query_params.append(float(max_price))
            
            if start_date:
                where_conditions.append("order_date >= ?")
                query_params.append(start_date)
            if end_date:
                where_conditions.append("order_date <= ?")
                query_params.append(end_date)
            
            where_clause = " AND ".join(where_conditions)
            
            sort_column_map = {
                'order_date': 'order_date',
                'product_name': 'product_name',
                'our_price': 'our_price',
                'quantity': 'quantity_ordered',
                'order_id': 'order_id'
            }
            sort_column = sort_column_map.get(sort_by, 'order_date')
            sort_dir = 'DESC' if sort_order == 'desc' else 'ASC'
            
            cursor.execute(f'''
                SELECT COUNT(*) as count
                FROM digital_items
                WHERE {where_clause}
            ''', query_params)
            total = cursor.fetchone()['count']
            
            offset = (page - 1) * limit
            cursor.execute(f'''
                SELECT 
                    order_id, order_date, product_name, our_price as total, quantity_ordered as quantity,
                    subscription_order_info
                FROM digital_items
                WHERE {where_clause}
                ORDER BY {sort_column} {sort_dir}
                LIMIT ? OFFSET ?
            ''', query_params + [limit, offset])
            
            for row in cursor.fetchall():
                orders.append({
                    'orderId': row['order_id'] or '',
                    'date': row['order_date'] or '',
                    'productName': row['product_name'] or '',
                    'total': float(row['total'] or 0),
                    'quantity': row['quantity'] or 0,
                    'status': 'Completed',
                    'paymentMethod': 'Digital Purchase',
                    'subscriptionInfo': row['subscription_order_info'] or '',
                })
        
        return {
            'orders': orders,
            'total': total,
            'page': page,
            'limit': limit,
            'totalPages': (total + limit - 1) // limit
        }
